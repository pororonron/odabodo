<div class="container">
  <div class="row no-gutters">
    <div class="col-sm-8 mx-auto">
      <div class="bg-form rounded p-3">
        <div class="d-flex justify-content-between">
          <div class="bg-form-2 p-2 d-flex rounded align-self-center">
            <%= image_tag @illustration.end_user.get_profile_image(50, 50), class: "rounded-circle align-self-center" %>
            <%= link_to end_user_path(@illustration.end_user_id), { class: "align-self-center pl-2" } do %>
              <span class="h3">
                <strong><%= @illustration.end_user.name %> </strong>さん
              </span>
            <% end %>
          </div>

          <div class="py-3 align-self-center">
            <% if @illustration.end_user_id == current_end_user.id %>
              <%= link_to 'イラスト内容を編集する', edit_illustration_path(@illustration), class: "text-link" %>
            <% end %>
          </div>
        </div>

        <div class="px-3">
          <div class="mt-5 h5 mx-3">
            <% if @illustration.theme.is_active == true %>
              <%= link_to theme_path(@illustration.theme_id), class: "d-flex" do %>
                <p>お題： </p>
                <p class="ml-4"><strong><%= @illustration.theme.title %></strong></p>
              <% end %>
            <% else %>
              <p>挑戦したお題は削除されています</p>
            <% end %>
          </div>
          <p class="border-bottom border-white"></p>

          <div class="mt-4 mb-3 mx-3 bg-form-2 p-2 rounded">
            <% @illustration.challenged_images.each do |challenged_image| %>
              <%= link_to image_tag(challenged_image.variant(resize_to_limit: [630, 630]).processed), url_for(challenged_image), class: "mx-auto" %>
            <% end %>
          </div>

          <p class="m-3"><%= @illustration.created_at %></p>

          <p class="mt-4 mb-3 mx-4 h4"><strong><%= @illustration.title %></strong></p>

          <% @illustration_tags.each do |illustration_tag| %>
            <%= link_to search_tag_homes_path(title: illustration_tag), method: :get do %>
              #<%= illustration_tag %>
            <% end %>
          <% end %>
          <p><%= @illustration.detail %></p>

          <% if @illustration.favorited_by?(current_end_user) %>
            <p>
              <%= link_to illustration_favorite_path(@illustration), method: :delete do %>
                <i class="fa-solid fa-heart"></i>
                <%= @illustration.favorites.count %>
              <% end %>
            </p>
          <% else %>
            <p>
              <%= link_to illustration_favorite_path(@illustration), method: :post do %>
                <i class="fa-regular fa-heart"></i>
                <%= @illustration.favorites.count %>
              <% end %>
            </p>
          <% end %>

          <% if @illustration.bookmarked_by?(current_end_user) %>
            <p>
              <%= link_to illustration_bookmark_path(@illustration), method: :delete do %>
                <i class="fa-solid fa-bookmark"></i>
                <%= @illustration.bookmarks.count %>
              <% end %>
            </p>
          <% else %>
            <p>
              <%= link_to illustration_bookmark_path(@illustration), method: :post do %>
                <i class="fa-regular fa-bookmark"></i>
                <%= @illustration.bookmarks.count %>
              <% end %>
            </p>
          <% end %>
        </div>
      </div>

      <div>
        <%= form_with model: [@illustration, @illustration_comment], local: true do |f| %>
          <%= f.text_area :comment, rows: '3', placeholder: 'コメントをここに' %>
          <%= f.submit '送信' %>
        <% end %>

        <% @illustration.illustration_comments.each do |illustration_comment| %>
          <%= image_tag illustration_comment.end_user.get_profile_image(50, 50) %>
          <%= illustration_comment.end_user.name %> さん
          <%= illustration_comment.comment %>
          <%= illustration_comment.created_at %>
          <% if illustration_comment.end_user == current_end_user %>
            <%= link_to '削除', illustration_illustration_comment_path(illustration_comment.illustration, illustration_comment),
              method: :delete, class: "btn btn-sm btn-secondary" %>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
</div>